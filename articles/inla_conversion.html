<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Converting legacy INLA mesh code to fmesher • fmesher</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Converting legacy INLA mesh code to fmesher">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmesher</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.7.9006</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Basic examples</h6></li>
    <li><a class="dropdown-item" href="../articles/basic_use.html">Basic use</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Concepts</h6></li>
    <li><a class="dropdown-item" href="../articles/inla_conversion.html">Conversion from legacy INLA package methods</a></li>
    <li><a class="dropdown-item" href="../articles/fmesher_library.html">The fmesher C++ library</a></li>
    <li><a class="dropdown-item" href="../articles/devel_flow.html">Devel: Internal algorithm flowcharts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/inlabru-org/fmesher/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Converting legacy INLA mesh code to fmesher</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/inlabru-org/fmesher/blob/devel/vignettes/inla_conversion.Rmd" class="external-link"><code>vignettes/inla_conversion.Rmd</code></a></small>
      <div class="d-none name"><code>inla_conversion.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="deprecation-warnings">Deprecation warnings<a class="anchor" aria-label="anchor" href="#deprecation-warnings"></a>
</h2>
<p>Three
<code>INLA::inla.getOption()</code>/<code>INLA::inla.setOption()</code>
options control the transition behaviour of the <code>INLA</code>
package use of <code>fmesher</code>.</p>
<ul>
<li>
<p><code>fmesher.evolution</code>, integer:</p>
<ul>
<li>
<code>1L</code> uses the intermediate <code>fm_*</code> methods in
<code>fmesher</code> that were already available via inlabru from 2.8.0,
but calls the <code>INLA</code> built-in <code>fmesher</code> standalone
programme for mesh construction and related operations. (From
<code>INLA</code> version 23.06.29)</li>
<li>
<code>2L</code> uses the full range of <code>fmesher</code> package
methods, and does not use the standalone <code>fmesher</code> programme.
(From <code>INLA</code> around version 23.08.20)</li>
</ul>
</li>
<li><p><code>fmesher.evolution.warn</code>, logical: When
<code>TRUE</code>, <code>INLA</code> will show deprecation methods for
all the methods in <code>INLA</code> that are being replaced by
<code>fmesher</code> package methods. When <code>FALSE</code>, no
warnings will be shown. Set this option to <code>TRUE</code> if you want
to update your own code, but keep it at <code>FALSE</code> when you need
to run existing code without changing it.</p></li>
<li><p><code>fmesher.evolution.verbosity</code>, character: Either
“soft”, “warn”, or “stop”, indicating the minimum warning level when
<code>fmesher.evolution.warn</code> is <code>TRUE</code>. Set this to
“warn” or “stop” to get more immediate feedback when testing conversion
of old code, e.g. in package testing.</p></li>
</ul>
<div class="section level3">
<h3 id="compatibility">Compatibility<a class="anchor" aria-label="anchor" href="#compatibility"></a>
</h3>
<p>Great effort has been taken to preserve backwards compatibility as
far as practical, with in particular the old <code>inla.mesh</code>,
<code>inla.mesh.1d</code>, and <code>inla.mesh.segment</code> object
classes given fallback methods that carry out methods for the new
<code>fm_mesh_2d</code>, <code>fm_mesh_1d</code>, and
<code>fm_segm</code> classes.</p>
<p>An important change is that the handling of mesh <code>crs</code>
information is now more flexible, but stricter in the sense that user
code should make no assumption about how the information is stored in
the mesh, and should therefore avoid the direct <code>mesh$crs</code>
access, and instead use the <code><a href="../reference/fm_crs.html">fm_crs()</a></code> and
<code><a href="../reference/fm_CRS_sp.html">fm_CRS()</a></code> access methods, depending on what type of CRS
object is needed. The ideal way to specify crs information is in the
initial mesh creation call. If the crs needs to be explicitly assigned a
new value, use the <code>fm_crs(mesh) &lt;- crs</code> assignment
method.</p>
<p>For mesh and curve creation, the <code><a href="../reference/fm_rcdt_2d.html">fm_rcdt_2d_inla()</a></code>,
<code><a href="../reference/fm_mesh_2d.html">fm_mesh_2d_inla()</a></code>, and
<code><a href="../reference/fm_nonconvex_hull_inla.html">fm_nonconvex_hull_inla()</a></code> methods will keep the interface
syntax used by <code>inla.mesh.create()</code>,
<code>inla.mesh.2d()</code>, and <code>inla.nonconvex.hull()</code>
functions, respectively, whereas the <code><a href="../reference/fm_rcdt_2d.html">fm_rcdt_2d()</a></code>,
<code><a href="../reference/fm_mesh_2d.html">fm_mesh_2d()</a></code>, and <code><a href="../reference/fm_nonconvex_hull.html">fm_nonconvex_hull()</a></code>
interfaces may change in the future.</p>
</div>
</div>
<div class="section level2">
<h2 id="mesh-construction">Mesh construction<a class="anchor" aria-label="anchor" href="#mesh-construction"></a>
</h2>
<table class="table">
<colgroup>
<col width="23%">
<col width="76%">
</colgroup>
<thead><tr class="header">
<th align="left">INLA</th>
<th align="left">fmesher</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>inla.mesh.create()</code></td>
<td align="left">
<a href="../reference/fm_rcdt_2d.html"><code>fm_rcdt_2d()</code></a>
,
<a href="../reference/fm_rcdt_2d.html"><code>fm_rcdt_2d_inla()</code></a>
</td>
</tr>
<tr class="even">
<td align="left"><code>inla.mesh.2d()</code></td>
<td align="left">
<a href="../reference/fm_mesh_2d.html"><code>fm_mesh_2d()</code></a>
,
<a href="../reference/fm_mesh_2d.html"><code>fm_mesh_2d_inla()</code></a>
</td>
</tr>
<tr class="odd">
<td align="left"><code>inla.delaunay()</code></td>
<td align="left"><a href="../reference/fm_rcdt_2d.html"><code>fm_delaunay_2d()</code></a></td>
</tr>
<tr class="even">
<td align="left"><code>inla.mesh.1d()</code></td>
<td align="left"><a href="../reference/fm_mesh_1d.html"><code>fm_mesh_1d()</code></a></td>
</tr>
<tr class="odd">
<td align="left"><code>inla.mesh.lattice()</code></td>
<td align="left"><a href="../reference/fm_lattice_2d.html"><code>fm_lattice_2d()</code></a></td>
</tr>
<tr class="even">
<td align="left"><code>inla.mesh.segment()</code></td>
<td align="left"><a href="../reference/fm_segm.html"><code>fm_segm()</code></a></td>
</tr>
<tr class="odd">
<td align="left"><code>inla.nonconvex.hull()</code></td>
<td align="left">
<a href="../reference/fm_nonconvex_hull.html"><code>fm_nonconvex_hull()</code></a>,
<a href="../reference/fm_nonconvex_hull.html"><code>fm_extensions()</code></a>
,
<a href="../reference/fm_simplify.html"><code>fm_simplify()</code></a>
</td>
</tr>
<tr class="even">
<td align="left">
<code>inla.nonconvex.hull()</code> ,
<code>inla.contour.segment()</code>,
<code>inla.simplify.curve()</code>
</td>
<td align="left">
<a href="../reference/fm_nonconvex_hull_inla.html"><code>fm_nonconvex_hull_inla()</code></a>,
<a href="../reference/fm_simplify_helper.html"><code>fm_simplify_helper()</code></a>
,
<a href="../reference/fm_segm_contour_helper.html"><code>fm_segm_contour_helper()</code></a>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="basis-and-function-evaluation">Basis and function evaluation<a class="anchor" aria-label="anchor" href="#basis-and-function-evaluation"></a>
</h2>
<table class="table">
<colgroup>
<col width="2%">
<col width="97%">
</colgroup>
<thead><tr class="header">
<th align="left">INLA</th>
<th align="left">fmesher</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>inla.mesh.projector()</code></td>
<td align="left"><a href="../reference/fm_evaluate.html"><code>fm_evaluator()</code></a></td>
</tr>
<tr class="even">
<td align="left"><code>inla.mesh.project()</code></td>
<td align="left"><a href="../reference/fm_evaluate.html"><code>fm_evaluate()</code></a></td>
</tr>
<tr class="odd">
<td align="left"><code>inla.spde.make.A()</code></td>
<td align="left">
<a href="../reference/fm_basis.html"><code>fm_basis()</code></a>
, <a href="../reference/fm_row_kron.html"><code>fm_row_kron()</code></a>
,
<a href="https://inlabru-org.github.io/inlabru/reference/bru_mapper_multi.html" class="external-link"><code>inlabru::bru_mapper_multi()</code></a>
,
<a href="https://inlabru-org.github.io/inlabru/reference/ibm_jacobian.html" class="external-link"><code>inlabru::ibm_jacobian()</code></a>
, <a href="../reference/fm_block.html"><code>fm_block()</code></a> ,
<a href="../reference/fm_block.html"><code>fm_block_eval()</code></a> ,
<a href="https://inlabru-org.github.io/inlabru/reference/bru_mapper_aggregate.html" class="external-link"><code>inlabru::bru_mapper_aggregate()</code></a>
</td>
</tr>
<tr class="even">
<td align="left"><code>inla.mesh.deriv()</code></td>
<td align="left"><a href="../reference/fm_basis.html"><code>fm_basis()</code></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="finite-element-methods">Finite element methods<a class="anchor" aria-label="anchor" href="#finite-element-methods"></a>
</h2>
<table class="table">
<colgroup>
<col width="14%">
<col width="21%">
<col width="63%">
</colgroup>
<thead><tr class="header">
<th align="left">INLA</th>
<th align="left">fmesher</th>
<th align="left">Comment</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">
<code>inla.mesh.fem()</code> ,
<code>inla.mesh.1d.fem()</code>
</td>
<td align="left"><a href="../reference/fm_fem.html"><code>fm_fem()</code></a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code></code></td>
<td align="left"><a href="../reference/fm_gmrf.html"><code>fm_matern_precision()</code></a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code></code></td>
<td align="left"><a href="../reference/fm_gmrf.html"><code>fm_matern_sample()</code></a></td>
<td align="left">Convenience function that combines
<code><a href="../reference/fm_gmrf.html">fm_matern_precision()</a></code> and <code><a href="../reference/fm_gmrf.html">fm_sample()</a></code>.</td>
</tr>
<tr class="even">
<td align="left"><code></code></td>
<td align="left"><a href="../reference/fm_gmrf.html"><code>fm_covariance()</code></a></td>
<td align="left">Basic helper function for compution covariances between
different locations. Can produce sparse inverses like
<code>inla.qinv()</code>, but currently (version 0.1.1) only by a ‘brute
force’ method.</td>
</tr>
<tr class="odd">
<td align="left"><code></code></td>
<td align="left"><a href="../reference/fm_gmrf.html"><code>fm_sample()</code></a></td>
<td align="left">Basic sampling method, like
<code>inla.qsample()</code>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="printing">Printing<a class="anchor" aria-label="anchor" href="#printing"></a>
</h2>
<table class="table">
<colgroup>
<col width="8%">
<col width="81%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">INLA</th>
<th align="left">fmesher</th>
<th align="left">Comments</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left"><code>summary.inla.mesh()</code></td>
<td align="left">
<a href="../reference/fmesher-print.html"><code>print.fm_mesh_2d()</code></a>,
<a href="../reference/fmesher-print.html"><code>print.fm_segm()</code></a>
,
<a href="../reference/fmesher-print.html"><code>print.fm_mesh_1d()</code></a>
</td>
<td align="left">Use <code>print(mesh)</code> etc.</td>
</tr></tbody>
</table>
</div>
<div class="section level2">
<h2 id="crs-information-and-coordinate-transformations">CRS information and coordinate transformations<a class="anchor" aria-label="anchor" href="#crs-information-and-coordinate-transformations"></a>
</h2>
<table class="table">
<colgroup>
<col width="7%">
<col width="38%">
<col width="53%">
</colgroup>
<thead><tr class="header">
<th align="left">INLA</th>
<th align="left">fmesher</th>
<th align="left">Comments</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>inla.spTransform()</code></td>
<td align="left"><a href="../reference/fm_transform.html"><code>fm_transform()</code></a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>mesh$crs</code></td>
<td align="left">
<a href="../reference/fm_crs.html"><code>fm_crs(mesh)</code></a>
,
<a href="../reference/fm_CRS_sp.html"><code>fm_CRS(mesh)</code></a>
</td>
<td align="left">The crs may now be stored in different formats; use
<code><a href="../reference/fm_crs.html">fm_crs()</a></code> for <code>sf</code> format, and
<code><a href="../reference/fm_CRS_sp.html">fm_CRS()</a></code> for <code>sp</code> format. <code>fmesher</code>
will attempt to convert when needed.</td>
</tr>
<tr class="odd">
<td align="left"><code>mesh$crs&lt;-</code></td>
<td align="left"><a href="../reference/fm_crs.html"><code>fm_crs(mesh)&lt;-</code></a></td>
<td align="left">Direct assignment of crs information should be avoided,
but is allowed as long as its compatible with the actual mesh
coordinates.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<table class="table">
<colgroup>
<col width="15%">
<col width="56%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="left">INLA</th>
<th align="left">fmesher</th>
<th align="left">Comment</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>No ggplot support</code></td>
<td align="left">
<a href="../reference/geom_fm.html"><code>geom_fm(data = mesh)</code></a>,
<a href="../reference/geom_fm.html"><code>geom_fm(data = segm)</code></a>
</td>
<td align="left">Use <code>ggplot() + geom_fm(data = mesh)</code> and
<code>inlabru::gg()</code> methods</td>
</tr>
<tr class="even">
<td align="left"><code>plot.inla.mesh(rgl = FALSE)</code></td>
<td align="left">
<a href="../reference/plot.fm_mesh_2d.html"><code>plot.fm_mesh_2d()</code></a>
,
<a href="../reference/plot.fm_mesh_2d.html"><code>lines.fm_mesh_2d()</code></a>
</td>
<td align="left">Use <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot()</a></code> or <code><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines()</a></code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>lines.inla.mesh.segment(rgl = FALSE)</code></td>
<td align="left">
<a href="../reference/plot.fm_segm.html"><code>plot.fm_segm()</code></a>
,
<a href="../reference/plot.fm_segm.html"><code>lines.fm_segm()</code></a>
</td>
<td align="left">Use <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot()</a></code> or <code><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines()</a></code>
</td>
</tr>
<tr class="even">
<td align="left"><code>plot.inla.mesh(rgl = TRUE)</code></td>
<td align="left">
<a href="../reference/plot_rgl.html"><code>plot_rgl()</code></a>
, <a href="../reference/plot_rgl.html"><code>lines_rgl()</code></a>
</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>lines.inla.mesh.segment(rgl = TRUE)</code></td>
<td align="left">
<a href="../reference/plot_rgl.html"><code>plot_rgl()</code></a>
, <a href="../reference/plot_rgl.html"><code>lines_rgl()</code></a>
</td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Finn Lindgren.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
