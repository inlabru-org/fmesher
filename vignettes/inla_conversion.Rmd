---
title: "Converting legacy INLA mesh code to fmesher"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Converting legacy INLA mesh code to fmesher}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE}
suppressPackageStartupMessages(library(fmesher))
suppressPackageStartupMessages(library(tibble))
```

```{r echo = FALSE}
df <- tribble(
  ~INLA, ~fmesher,
  "inla.mesh.create()", c("fm_rcdt_2d()", "fm_rcdt_2d_inla()"),
  "inla.mesh.2d()", c("fm_mesh_2d()", "fm_mesh_2d_inla()"),
  "inla.delaunay()", "fm_delaunay_2d()",
  "inla.mesh.1d()", "fm_mesh_1d()",
  "inla.mesh.lattice()", "fm_lattice_2d()",
  "inla.mesh.segment()", "fm_segm()",
  "inla.nonconvex.hull()", c("fm_nonconvex_hull()", "fm_extensions()"),
  c(
    "inla.nonconvex.hull()",
    "inla.contour.segment()",
    "inla.simplify.curve()"
  ),
  c(
    "fm_nonconvex_hull_inla()",
    "fm_simplify_helper()",
    "fm_segm_contour_helper()"
  ),
  c("inla.mesh.boundary()", "inla.mesh.interior()"), "fm_segm()",
  "inla.mesh.projector()", "fm_evaluator()",
  "inla.mesh.project()", "fm_evaluate()",
  "inla.CRS()", c("fm_crs()", "fm_CRS()", "fm_crs<-()"),
  "inla.spTransform()", "fm_transform()",
  "inla.spde.make.A()", c("fm_basis()", "fm_row_kron()"),
  "inla.mesh.deriv()", "fm_basis()",
  "plot.inla.mesh(rgl = FALSE)", "plot.fm_mesh_2d()",
  "lines.inla.mesh.segment(rgl = FALSE)", c(
    "plot.fm_segm()",
    "lines.fm_segm()"
  ),
  "plot.inla.mesh(rgl = TRUE)", "plot_rgl()",
  "lines.inla.mesh.segment(rgl = TRUE)", c(
    "plot_rgl()",
    "lines_rgl()"
  ),
  "summary.inla.mesh()", c(
    "print.fm_mesh_2d()",
    "print.fm_segm()",
    "print.fm_mesh_1d()"
  )
)

# webref <- "https://inlabru-org.github.io/fmesher/reference/"
webref <- "../reference/"
for (k in seq_len(nrow(df))) {
  df$fmesher[[k]] <-
    vapply(
      df$fmesher[[k]],
      function(x) {
        nm <- sub(
          pattern = "([^(]+)(\\(.*\\))$",
          replacement = "\\1",
          x = x
        )
        args <- sub(
          pattern = "([^(]+)(\\(.*\\))$",
          replacement = "\\2",
          x = x
        )
        help_name <- basename(utils::help(nm, package = "fmesher"))
        paste0('<a href="', webref, help_name, '.html">', nm, "</a>", args)
      },
      ""
    )
}
```

```{r, echo = FALSE}
knitr::kable(df)
```
